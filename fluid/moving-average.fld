import methane

def nthPad(n, xs):
  nth(min(max(n, 0), length(xs) - 1), xs)
def movingAvg(ys, window):
  [sum([nthPad(n, ys) for n in [i - window .. i + window]]) / (1 + 2 * window) for i in [0 .. length(ys) - 1]]
def movingAvg'(rs, window):
  zipWith((lambda x, y: { x: x, y: y }), map((lambda r: r.x), rs), movingAvg(map((lambda r: r.y), rs), window));

def points:
  [{ x: r.year, y: r.emissions } for r in methane if r.type == "Agriculture"];

LineChart({
  tickLabels: { x: Rotated, y: Default },
  size: { width: 330, height: 285 },
  caption: "SSP5-8.5 projected methane emissions (Agriculture)",
  plots: [
    LinePlot({
      name: "Moving average",
      points: movingAvg'(points, 1)
    }),
    LinePlot({ name: "Original curve", points: points })
  ]
})
